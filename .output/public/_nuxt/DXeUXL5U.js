import{_ as me,r as _,o as _e,J as Te,x as J,y as D,z as V,K as re,A as Z,B as ve,C as Oe,L as Re,T as ze}from"./0Y2rBl_W.js";import{P as ue,W as Fe}from"./Bp2l3kpD.js";class fe{constructor(){this.image=null,this.collision=!1}async loadImage(s){return new Promise(t=>{this.image=new Image,this.image.onload=()=>t(),this.image.src=s})}}class Le{constructor(s,t,i){this.tiles=[],this.tileMap=[],this.maxScreenCol=s,this.maxScreenRow=t,this.tileSize=i,this.tiles=new Array(20).fill(null).map(()=>new fe),this.tileMap=Array(s).fill(0).map(()=>Array(t).fill(0))}async loadTiles(){const t=[{path:"/map/SeRenta.png",collision:!0},{path:"/map/grass.png",collision:!0},{path:"/map/tree.png",collision:!0},{path:"/map/Peluqueria.png",collision:!0},{path:"/map/Bar.png",collision:!0},{path:"/map/roadNEWS.png",collision:!1},{path:"/map/roadNS.png",collision:!1},{path:"/map/Farmacia.png",collision:!0},{path:"/map/Fotostudio.png",collision:!0},{path:"/map/Panaderia.png",collision:!0},{path:"/map/Fruteria.png",collision:!0},{path:"/map/Musica.png",collision:!0},{path:"/map/Cafe.png",collision:!0},{path:null,collision:!1},{path:"/map/Internet.png",collision:!0},{path:"/map/roadEW.png",collision:!1},{path:"/map/roadSW.png",collision:!1},{path:"/map/roadNE.png",collision:!1},{path:"/map/roadSE.png",collision:!1},{path:"/map/roadNW.png",collision:!1},{path:"/map/tiendasD1.png",collision:!0},{path:"/map/tiendasAra.png",collision:!0}].map((i,c)=>i.path?new Promise(p=>{this.tiles[c]=new fe,this.tiles[c].collision=i.collision,this.tiles[c].image=new Image,this.tiles[c].image.onload=()=>p(),this.tiles[c].image.src=i.path}):Promise.resolve());await Promise.all(t)}async loadMap(s){const t=s.trim().split(`
`);for(let i=0;i<this.maxScreenRow;i++){const c=t[i].trim().split(" ");for(let p=0;p<this.maxScreenCol;p++)this.tileMap[p][i]=parseInt(c[p])}}draw(s){for(let t=0;t<this.maxScreenRow;t++)for(let i=0;i<this.maxScreenCol;i++){const c=i*this.tileSize,p=t*this.tileSize,m=this.tileMap[i][t];this.tiles[m]&&this.tiles[m].image&&s.drawImage(this.tiles[m].image,c,p,this.tileSize,this.tileSize)}}getTileCollision(s,t){if(s<0||s>=this.maxScreenCol||t<0||t>=this.maxScreenRow)return!0;const i=this.tileMap[s][t];return this.tiles[i]?.collision??!1}}class we{constructor(){this.name="",this.image=null,this.collision=!1,this.x=0,this.y=0,this.scale=1}draw(s,t){if(this.image){const i=t.tileSize*.7,c=(t.tileSize-i)/2,p=(t.tileSize-i)/2;s.drawImage(this.image,this.x+c,this.y+p,i,i)}}}class Ne extends we{constructor(s){super(),this.name="person",this.loadImage(s),this.active=!0}async loadImage(s){return new Promise(t=>{this.image=new Image,this.image.onload=()=>t(),this.image.src=`/person/${s}`})}}class je extends we{constructor(s){super(),this.name="obstacles",this.collision=!1,this.loadImage(s)}async loadImage(s){return new Promise(t=>{this.image=new Image,this.image.onload=()=>t(),this.image.src=`/objects/${s}`})}}class Be{constructor(s){this.tileSize=s,this.objects=new Array(15).fill(null),this.personImages={p1:"PersonaCorbata.png",p2:"PersonaNaranja.png",p3:"mujer.png",p4:"mujer1.png",p5:"personaCampesino.png",p6:"personaEstudiante.png",p7:"personaVerde.png",p8:"tombo.png",p9:"tombo1.png"}}async setObjects(s=null){const t=s?this.processServerData(s):[],i=[{file:"huecos.png",x:6,y:6},{file:"motoEnElPiso.png",x:3,y:3},{file:"senal.png",x:9,y:11},{file:"senal1.png",x:9,y:10},{file:"senal2.png",x:8,y:9},{file:"senal3.png",x:9,y:9}],c=[];return t.forEach((p,m)=>{this.objects[m]=new Ne(p.file),this.objects[m].x=p.x*this.tileSize,this.objects[m].y=p.y*this.tileSize,this.objects[m].id=p.id,this.objects[m].active=!0,c.push(this.objects[m].loadImage(p.file))}),i.forEach((p,m)=>{const I=m+t.length;this.objects[I]=new je(p.file),this.objects[I].x=p.x*this.tileSize,this.objects[I].y=p.y*this.tileSize,c.push(this.objects[I].loadImage(p.file))}),await Promise.all(c),console.log("All images loaded"),console.log("Objects:",this.objects),this.objects}processServerData(s){return!s.persons||s.type!=="availablePersons"?(console.error("Invalid server data format"),[]):(console.log("Server data:",s),console.log("Server data persons:",s.persons),Object.entries(s.persons).map(([t,i])=>({file:this.personImages[t],x:i.x,y:i.y,id:i.id})))}}class We{constructor(s,t){this.tileSize=s,this.tileManager=t}checkTile(s){const t=s.x+s.solidArea.x,i=s.x+s.solidArea.x+s.solidArea.width,c=s.y+s.solidArea.y,p=s.y+s.solidArea.y+s.solidArea.height,m=Math.floor(t/this.tileSize),I=Math.floor(i/this.tileSize),y=Math.floor(c/this.tileSize),E=Math.floor(p/this.tileSize);let k,w;switch(s.direction){case"up":const R=Math.floor((c-s.speed)/this.tileSize);k=this.tileManager.tileMap[m][R],w=this.tileManager.tileMap[I][R],(this.tileManager.tiles[k]?.collision||this.tileManager.tiles[w]?.collision)&&(s.collisionOn=!0);break;case"down":const F=Math.floor((p+s.speed)/this.tileSize);k=this.tileManager.tileMap[m][F],w=this.tileManager.tileMap[I][F],(this.tileManager.tiles[k]?.collision||this.tileManager.tiles[w]?.collision)&&(s.collisionOn=!0);break;case"left":const U=Math.floor((t-s.speed)/this.tileSize);k=this.tileManager.tileMap[U][y],w=this.tileManager.tileMap[U][E],(this.tileManager.tiles[k]?.collision||this.tileManager.tiles[w]?.collision)&&(s.collisionOn=!0);break;case"right":const B=Math.floor((i+s.speed)/this.tileSize);k=this.tileManager.tileMap[B][y],w=this.tileManager.tileMap[B][E],(this.tileManager.tiles[k]?.collision||this.tileManager.tiles[w]?.collision)&&(s.collisionOn=!0);break}}checkObject(s,t,i=!1,c=null){let p=999;return t.forEach((m,I)=>{if(!m)return;const y={x:s.x+s.solidArea.x,y:s.y+s.solidArea.y,width:s.solidArea.width,height:s.solidArea.height},E={x:m.x+(m.solidArea?.x||0),y:m.y+(m.solidArea?.y||0),width:m.solidArea?.width||this.tileSize,height:m.solidArea?.height||this.tileSize};switch(s.direction){case"up":y.y-=s.speed;break;case"down":y.y+=s.speed;break;case"left":y.x-=s.speed;break;case"right":y.x+=s.speed;break}this.checkIntersect(y,E)&&(m.collision&&(s.collisionOn=!0),i&&(p=I),i&&c&&c.isConnected&&(s.hasPerson=!s.hasPerson,c.sendHasPersonUpdate(s.hasPerson)))}),p}checkIntersect(s,t){return s.x<t.x+t.width&&s.x+s.width>t.x&&s.y<t.y+t.height&&s.y+s.height>t.y}checkPlayerCollision(s,t){for(const i of t){if(!i||i.id===s.id)continue;const c={x:s.x+s.solidArea.x,y:s.y+s.solidArea.y,width:s.solidArea.width,height:s.solidArea.height};switch(s.direction){case"up":c.y-=s.speed;break;case"down":c.y+=s.speed;break;case"left":c.x-=s.speed;break;case"right":c.x+=s.speed;break}const p={x:i.x+i.solidArea.x,y:i.y+i.solidArea.y,width:i.solidArea.width,height:i.solidArea.height};if(this.checkIntersect(c,p))return s.collisionOn=!0,!0}return!1}}class Ue{constructor(){this.upPressed=!1,this.downPressed=!1,this.leftPressed=!1,this.rightPressed=!1,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}init(){typeof window<"u"&&(window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp))}handleKeyDown(s){switch(s.key.toLowerCase()){case"w":this.upPressed=!0;break;case"s":this.downPressed=!0;break;case"a":this.leftPressed=!0;break;case"d":this.rightPressed=!0;break}}handleKeyUp(s){switch(s.key.toLowerCase()){case"w":this.upPressed=!1;break;case"s":this.downPressed=!1;break;case"a":this.leftPressed=!1;break;case"d":this.rightPressed=!1;break}}cleanup(){typeof window<"u"&&(window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp))}}var ne={};(function z(s,t,i,c){var p=!!(s.Worker&&s.Blob&&s.Promise&&s.OffscreenCanvas&&s.OffscreenCanvasRenderingContext2D&&s.HTMLCanvasElement&&s.HTMLCanvasElement.prototype.transferControlToOffscreen&&s.URL&&s.URL.createObjectURL),m=typeof Path2D=="function"&&typeof DOMMatrix=="function",I=function(){if(!s.OffscreenCanvas)return!1;var a=new OffscreenCanvas(1,1),e=a.getContext("2d");e.fillRect(0,0,1,1);var r=a.transferToImageBitmap();try{e.createPattern(r,"no-repeat")}catch{return!1}return!0}();function y(){}function E(a){var e=t.exports.Promise,r=e!==void 0?e:s.Promise;return typeof r=="function"?new r(a):(a(y,y),null)}var k=function(a,e){return{transform:function(r){if(a)return r;if(e.has(r))return e.get(r);var o=new OffscreenCanvas(r.width,r.height),h=o.getContext("2d");return h.drawImage(r,0,0),e.set(r,o),o},clear:function(){e.clear()}}}(I,new Map),w=function(){var a=Math.floor(16.666666666666668),e,r,o={},h=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(d){var u=Math.random();return o[u]=requestAnimationFrame(function n(f){h===f||h+a-1<f?(h=f,delete o[u],d()):o[u]=requestAnimationFrame(n)}),u},r=function(d){o[d]&&cancelAnimationFrame(o[d])}):(e=function(d){return setTimeout(d,a)},r=function(d){return clearTimeout(d)}),{frame:e,cancel:r}}(),R=function(){var a,e,r={};function o(h){function d(u,n){h.postMessage({options:u||{},callback:n})}h.init=function(n){var f=n.transferControlToOffscreen();h.postMessage({canvas:f},[f])},h.fire=function(n,f,M){if(e)return d(n,null),e;var C=Math.random().toString(36).slice(2);return e=E(function(b){function x(A){A.data.callback===C&&(delete r[C],h.removeEventListener("message",x),e=null,k.clear(),M(),b())}h.addEventListener("message",x),d(n,C),r[C]=x.bind(null,{data:{callback:C}})}),e},h.reset=function(){h.postMessage({reset:!0});for(var n in r)r[n](),delete r[n]}}return function(){if(a)return a;if(!i&&p){var h=["var CONFETTI, SIZE = {}, module = {};","("+z.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{a=new Worker(URL.createObjectURL(new Blob([h])))}catch(d){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",d),null}o(a)}return a}}(),F={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function U(a,e){return e?e(a):a}function B(a){return a!=null}function P(a,e,r){return U(a&&B(a[e])?a[e]:F[e],r)}function Y(a){return a<0?0:Math.floor(a)}function ae(a,e){return Math.floor(Math.random()*(e-a))+a}function q(a){return parseInt(a,16)}function Q(a){return a.map(se)}function se(a){var e=String(a).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:q(e.substring(0,2)),g:q(e.substring(2,4)),b:q(e.substring(4,6))}}function te(a){var e=P(a,"origin",Object);return e.x=P(e,"x",Number),e.y=P(e,"y",Number),e}function ee(a){a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight}function S(a){var e=a.getBoundingClientRect();a.width=e.width,a.height=e.height}function K(a){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=a,e}function l(a,e,r,o,h,d,u,n,f){a.save(),a.translate(e,r),a.rotate(d),a.scale(o,h),a.arc(0,0,1,u,n,f),a.restore()}function T(a){var e=a.angle*(Math.PI/180),r=a.spread*(Math.PI/180);return{x:a.x,y:a.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:a.startVelocity*.5+Math.random()*a.startVelocity,angle2D:-e+(.5*r-Math.random()*r),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:a.color,shape:a.shape,tick:0,totalTicks:a.ticks,decay:a.decay,drift:a.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:a.gravity*3,ovalScalar:.6,scalar:a.scalar,flat:a.flat}}function v(a,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var r=e.tick++/e.totalTicks,o=e.x+e.random*e.tiltCos,h=e.y+e.random*e.tiltSin,d=e.wobbleX+e.random*e.tiltCos,u=e.wobbleY+e.random*e.tiltSin;if(a.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-r)+")",a.beginPath(),m&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))a.fill(ye(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(d-o)*.1,Math.abs(u-h)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var n=Math.PI/10*e.wobble,f=Math.abs(d-o)*.1,M=Math.abs(u-h)*.1,C=e.shape.bitmap.width*e.scalar,b=e.shape.bitmap.height*e.scalar,x=new DOMMatrix([Math.cos(n)*f,Math.sin(n)*f,-Math.sin(n)*M,Math.cos(n)*M,e.x,e.y]);x.multiplySelf(new DOMMatrix(e.shape.matrix));var A=a.createPattern(k.transform(e.shape.bitmap),"no-repeat");A.setTransform(x),a.globalAlpha=1-r,a.fillStyle=A,a.fillRect(e.x-C/2,e.y-b/2,C,b),a.globalAlpha=1}else if(e.shape==="circle")a.ellipse?a.ellipse(e.x,e.y,Math.abs(d-o)*e.ovalScalar,Math.abs(u-h)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):l(a,e.x,e.y,Math.abs(d-o)*e.ovalScalar,Math.abs(u-h)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var g=Math.PI/2*3,O=4*e.scalar,L=8*e.scalar,N=e.x,W=e.y,H=5,j=Math.PI/H;H--;)N=e.x+Math.cos(g)*L,W=e.y+Math.sin(g)*L,a.lineTo(N,W),g+=j,N=e.x+Math.cos(g)*O,W=e.y+Math.sin(g)*O,a.lineTo(N,W),g+=j;else a.moveTo(Math.floor(e.x),Math.floor(e.y)),a.lineTo(Math.floor(e.wobbleX),Math.floor(h)),a.lineTo(Math.floor(d),Math.floor(u)),a.lineTo(Math.floor(o),Math.floor(e.wobbleY));return a.closePath(),a.fill(),e.tick<e.totalTicks}function G(a,e,r,o,h){var d=e.slice(),u=a.getContext("2d"),n,f,M=E(function(C){function b(){n=f=null,u.clearRect(0,0,o.width,o.height),k.clear(),h(),C()}function x(){i&&!(o.width===c.width&&o.height===c.height)&&(o.width=a.width=c.width,o.height=a.height=c.height),!o.width&&!o.height&&(r(a),o.width=a.width,o.height=a.height),u.clearRect(0,0,o.width,o.height),d=d.filter(function(A){return v(u,A)}),d.length?n=w.frame(x):b()}n=w.frame(x),f=b});return{addFettis:function(C){return d=d.concat(C),M},canvas:a,promise:M,reset:function(){n&&w.cancel(n),f&&f()}}}function X(a,e){var r=!a,o=!!P(e||{},"resize"),h=!1,d=P(e,"disableForReducedMotion",Boolean),u=p&&!!P(e||{},"useWorker"),n=u?R():null,f=r?ee:S,M=a&&n?!!a.__confetti_initialized:!1,C=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,b;function x(g,O,L){for(var N=P(g,"particleCount",Y),W=P(g,"angle",Number),H=P(g,"spread",Number),j=P(g,"startVelocity",Number),Pe=P(g,"decay",Number),Ce=P(g,"gravity",Number),xe=P(g,"drift",Number),le=P(g,"colors",Q),Se=P(g,"ticks",Number),ce=P(g,"shapes"),Ie=P(g,"scalar"),ke=!!P(g,"flat"),he=te(g),de=N,ie=[],Ae=a.width*he.x,Ee=a.height*he.y;de--;)ie.push(T({x:Ae,y:Ee,angle:W,spread:H,startVelocity:j,color:le[de%le.length],shape:ce[ae(0,ce.length)],ticks:Se,decay:Pe,gravity:Ce,drift:xe,scalar:Ie,flat:ke}));return b?b.addFettis(ie):(b=G(a,ie,f,O,L),b.promise)}function A(g){var O=d||P(g,"disableForReducedMotion",Boolean),L=P(g,"zIndex",Number);if(O&&C)return E(function(j){j()});r&&b?a=b.canvas:r&&!a&&(a=K(L),document.body.appendChild(a)),o&&!M&&f(a);var N={width:a.width,height:a.height};n&&!M&&n.init(a),M=!0,n&&(a.__confetti_initialized=!0);function W(){if(n){var j={getBoundingClientRect:function(){if(!r)return a.getBoundingClientRect()}};f(j),n.postMessage({resize:{width:j.width,height:j.height}});return}N.width=N.height=null}function H(){b=null,o&&(h=!1,s.removeEventListener("resize",W)),r&&a&&(document.body.contains(a)&&document.body.removeChild(a),a=null,M=!1)}return o&&!h&&(h=!0,s.addEventListener("resize",W,!1)),n?n.fire(g,N,H):x(g,N,H)}return A.reset=function(){n&&n.reset(),b&&b.reset()},A}var $;function oe(){return $||($=X(null,{useWorker:!0,resize:!0})),$}function ye(a,e,r,o,h,d,u){var n=new Path2D(a),f=new Path2D;f.addPath(n,new DOMMatrix(e));var M=new Path2D;return M.addPath(f,new DOMMatrix([Math.cos(u)*h,Math.sin(u)*h,-Math.sin(u)*d,Math.cos(u)*d,r,o])),M}function Me(a){if(!m)throw new Error("path confetti are not supported in this browser");var e,r;typeof a=="string"?e=a:(e=a.path,r=a.matrix);var o=new Path2D(e),h=document.createElement("canvas"),d=h.getContext("2d");if(!r){for(var u=1e3,n=u,f=u,M=0,C=0,b,x,A=0;A<u;A+=2)for(var g=0;g<u;g+=2)d.isPointInPath(o,A,g,"nonzero")&&(n=Math.min(n,A),f=Math.min(f,g),M=Math.max(M,A),C=Math.max(C,g));b=M-n,x=C-f;var O=10,L=Math.min(O/b,O/x);r=[L,0,0,L,-Math.round(b/2+n)*L,-Math.round(x/2+f)*L]}return{type:"path",path:e,matrix:r}}function be(a){var e,r=1,o="#000000",h='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof a=="string"?e=a:(e=a.text,r="scalar"in a?a.scalar:r,h="fontFamily"in a?a.fontFamily:h,o="color"in a?a.color:o);var d=10*r,u=""+d+"px "+h,n=new OffscreenCanvas(d,d),f=n.getContext("2d");f.font=u;var M=f.measureText(e),C=Math.ceil(M.actualBoundingBoxRight+M.actualBoundingBoxLeft),b=Math.ceil(M.actualBoundingBoxAscent+M.actualBoundingBoxDescent),x=2,A=M.actualBoundingBoxLeft+x,g=M.actualBoundingBoxAscent+x;C+=x+x,b+=x+x,n=new OffscreenCanvas(C,b),f=n.getContext("2d"),f.font=u,f.fillStyle=o,f.fillText(e,A,g);var O=1/r;return{type:"bitmap",bitmap:n.transferToImageBitmap(),matrix:[O,0,0,O,-C*O/2,-b*O/2]}}t.exports=function(){return oe().apply(this,arguments)},t.exports.reset=function(){oe().reset()},t.exports.create=X,t.exports.shapeFromPath=Me,t.exports.shapeFromText=be})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),ne,!1);const Ke=ne.exports;ne.exports.create;const Ve={class:"game-container"},He={class:"game-hud"},Ze={class:"player-info"},Ge={class:"player-name"},$e={class:"license-plate"},qe={class:"score"},Xe={class:"players-online"},Je={key:0,class:"collision-debug"},De={key:0,class:"collision-message"},Ye={key:1,class:"end-game-overlay result-container"},Qe=26,ea=3,pe=16,ge=12,aa={__name:"GameCanvas",setup(z){const s=Qe*ea,t=s*pe,i=s*ge,c=_(new Ue),p=_(null),m=_(null),I=_(null),y=_(new ue(t,i,s)),E=_(new Array(15).fill(null)),k=_(null),w=_(new Fe),R=_(new Map),F=_({lastCollision:null,debug:!1}),U=_(localStorage.getItem("licensePlate")||""),B=_(!1),P=_(!1),Y=_(""),ae=_(""),q=async()=>{I.value=new Le(pe,ge,s),k.value=new We(s,I.value);const S=new Be(s);w.value.onInitialData=async l=>{E.value=await S.setObjects(l)},w.value.setInitialDataCallback(async l=>{console.log("Initializing game with server data"),E.value=await S.setObjects(l)}),await Promise.all([I.value.loadTiles(),y.value.loadImages(),S.setObjects().then(l=>{E.value=l})]),await I.value.loadMap(`
    15 16 1 6 3 1 6 2 1 6 1 8 6 2 18 15
    1 6 2 6 21 14 6 1 4 6 20 1 6 1 6 2
    1 17 15 5 15 15 5 15 15 5 15 15 5 15 19 1
    2 9 0 6 1 7 6 1 3 6 1 8 6 4 1 0
    20 1 1 6 10 1 6 1 2 6 21 1 6 1 11 2
    15 15 15 5 15 15 5 15 15 5 15 15 5 15 15 15
    1 2 1 6 4 2 6 1 12 6 1 3 6 2 10 1
    3 1 11 6 1 14 6 1 1 6 7 1 6 1 2 1
    1 1 2 6 2 1 6 0 1 6 1 1 6 20 1 1
    1 18 15 5 15 15 5 15 15 5 15 15 5 15 16 9
    9 6 2 6 1 1 6 10 20 6 14 2 6 14 6 1
    15 19 1 6 12 2 6 1 1 6 1 1 6 1 17 15

`),w.value.onPlayersUpdate=async l=>{const T=w.value.getLocalPlayerId();if(l.type==="personState"){const v=l.personId,G=l.active,X=E.value.find($=>$&&$.id===v);X&&(X.active=G,console.log(`ðŸŽ­ Person ${v} state updated to ${G} by player ${l.playerId}`));return}if(l.id===T&&(U.value=l.id,y.value.id=l.id),!R.value.has(l.id)&&l.id!==T){const v=new ue(t,i,s,l.id);await v.loadImages(),R.value.set(l.id,v)}if(l.id!==T){const v=R.value.get(l.id);if(v){const G="hasPerson"in l&&v.hasPerson!==l.hasPerson;v.x=l.x??v.x,v.y=l.y??v.y,v.direction=l.direction??v.direction,G&&(v.hasPerson=l.hasPerson,v.getCurrentImage(),console.log("ðŸŽ® Player Update:",{id:l.id,hasPerson:l.hasPerson,timestamp:new Date().toISOString()}),v.hasPerson>=7&&!B.value&&Q(l.id===w.value.getLocalPlayerId()))}}},w.value.onPlayerDisconnect=l=>{R.value.delete(l)},w.value.onConnect=l=>{U.value=l,y.value.id=l,localStorage.setItem("licensePlate",l)}};function Q(S){B.value=!0,P.value=S,S&&Ke({particleCount:150,spread:70,origin:{y:.6}}),cancelAnimationFrame(m.value),w.value?.close()}const se=()=>{const S=p.value.getContext("2d");S.clearRect(0,0,t,i),S.fillStyle="black",S.fillRect(0,0,t,i),I.value&&I.value.draw(S),console.log();const K=w.value.getLocalPlayerId(),l=[...R.value.values()].filter(T=>T.id!==K);l.sort((T,v)=>T.y-v.y);for(let T=0;T<i;T++)E.value.forEach(v=>{v&&v.y===T&&v.draw(S,{tileSize:s})}),l.forEach(v=>{Math.floor(v.y)===T&&v.draw(S)});y.value.draw(S)},te=()=>{if(y.value&&k.value){const S={up:c.value.upPressed,down:c.value.downPressed,left:c.value.leftPressed,right:c.value.rightPressed},K=[...R.value.values()];y.value.update(S,k.value,E.value,w.value,K)&&w.value.sendPlayerPosition({id:w.value.getLocalPlayerId(),x:y.value.x,y:y.value.y,direction:y.value.direction,hasPerson:y.value.hasPerson}),y.value.hasPerson>=7&&!B.value&&Q(!0),F.value.debug&&K.forEach(l=>{k.value.checkPlayerCollision(y.value,[l])&&(F.value.lastCollision={time:Date.now(),player1:y.value.id,player2:l.id})})}},ee=()=>{te(),se(),m.value=requestAnimationFrame(ee)};return _e(async()=>{Y.value=localStorage.getItem("playerName")||"Unknown",ae.value=localStorage.getItem("licensePlate")||"XXX-000",await q(),c.value.init(),w.value.connect(),ee()}),Te(()=>{c.value.cleanup(),w.value.disconnect(),m.value&&cancelAnimationFrame(m.value)}),(S,K)=>(D(),J("div",Ve,[V("canvas",{ref_key:"gameCanvas",ref:p,width:t,height:i},null,512),V("div",He,[V("div",Ze,[V("span",Ge,"Jugador: "+Z(Y.value),1),V("span",$e,"Placa: "+Z(U.value),1),V("span",qe,"Personas: "+Z(y.value.hasPerson),1),V("span",Xe,"Jugadores Online: "+Z(R.value.size+1),1)])]),F.value.debug?(D(),J("div",Je,[F.value.lastCollision?(D(),J("div",De," Â¡ColisiÃ³n detectada! Jugadores: "+Z(F.value.lastCollision.player1)+" y "+Z(F.value.lastCollision.player2),1)):re("",!0)])):re("",!0),B.value?(D(),J("div",Ye,[ve(ze,{name:"fade"},{default:Oe(()=>[V("div",{class:Re(["result-message",P.value?"glow":""])},Z(P.value?"You Win!":"Game Over"),3)]),_:1})])):re("",!0)]))}},sa=me(aa,[["__scopeId","data-v-503d01fa"]]),ta={class:"game-page"},ia={__name:"page",setup(z){return(s,t)=>(D(),J("div",ta,[ve(sa)]))}},oa=me(ia,[["__scopeId","data-v-84cfa301"]]);export{oa as default};
