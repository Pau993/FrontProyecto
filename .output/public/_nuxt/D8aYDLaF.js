import{_ as k,r as n,t as i,x as s,I as f,L as g,M as y,N as h,y as u,O as x,P as S,v as d}from"./DVNOL9sH.js";import{o as C}from"./DvUShIk5.js";const P=window.setInterval,T={class:"login-container"},B={class:"form-group"},D={class:"form-group"},U=["disabled"],V={key:0,class:"error-message"},E={key:1,class:"info-message"},L={key:0,class:"modal-overlay"},M={class:"modal-content"},N={__name:"login",setup(A){const c=n(!1),v=n(""),p=n(""),t=n(""),r=n(!1),_=S(),o=n(0),l=n(3),I=()=>{if(o.value>0){c.value=!0;const a=P(()=>{o.value--,o.value<=0&&(clearInterval(a),c.value=!1,l.value=3,t.value="")},1e3)}},b=()=>{c.value=!1,t.value=""},w=async()=>{r.value=!0,t.value="";try{const a=await $fetch("http://localhost:8080/api/login",{method:"POST",body:{username:v.value,password:p.value}});sessionStorage.setItem("token",a.token);const e=C(a.token);console.log("Token identificado",e),e.role==="admin"?_.push("/view"):_.push("/generation")}catch(a){if(a.status===429){const e=a.response.json();t.value="Demasiados intentos fallidos. Intenta de nuevo cuando termine el tiempo de espera.",o.value=e.retryAfter||60,l.value=e.attemptsLeft??0,I()}else a.status===401?(t.value="Usuario o contrase침a incorrectos.",l.value>0&&l.value--):t.value="Error al iniciar sesi칩n. Intenta de nuevo."}finally{r.value=!1}};return(a,e)=>(d(),i("div",T,[s("form",{onSubmit:x(w,["prevent"]),class:"login-form"},[e[2]||(e[2]=s("h2",{class:"login-title"},"Bienvenido a SITS",-1)),e[3]||(e[3]=s("p",{class:"login-subtitle"},"Por favor ingresa usuario y contrase침a",-1)),s("div",B,[g(s("input",{"onUpdate:modelValue":e[0]||(e[0]=m=>v.value=m),type:"text",placeholder:"Usuario",class:h(["input-field",{"input-error":t.value}]),autocomplete:"username"},null,2),[[y,v.value]])]),s("div",D,[g(s("input",{"onUpdate:modelValue":e[1]||(e[1]=m=>p.value=m),type:"password",placeholder:"Contrase침a",class:h(["input-field",{"input-error":t.value}]),autocomplete:"current-password"},null,2),[[y,p.value]])]),s("button",{type:"submit",disabled:r.value||o.value>0,class:"submit-button"},u(r.value?"Ingresando...":"Entrar"),9,U),t.value?(d(),i("p",V,u(t.value),1)):f("",!0),o.value===0&&l.value>=0?(d(),i("p",E," Intentos restantes: "+u(l.value),1)):f("",!0)],32),o.value>0?(d(),i("div",L,[s("div",M,[s("p",null,"Demasiados intentos fallidos. Intenta de nuevo en "+u(o.value)+" segundos.",1),s("button",{onClick:b},"Cerrar")])])):f("",!0)]))}},z=k(N,[["__scopeId","data-v-ab14351f"]]);export{z as default};
